<form [formGroup]="form" (ngSubmit)="submit()" class="form card-ui" style="padding: 1rem">
  <h2>@if (isEdit()) { Edit Recipe } @else { New Recipe }</h2>

  <label>
    <span>Title</span>
    <input type="text" formControlName="title" placeholder="e.g., Classic Pancakes" />
    @if (form.get('title')!.invalid && form.get('title')!.touched) {
    <small class="error">Title is required (min 3 chars)</small>
    }
  </label>

  <label>
    <span>Description</span>
    <textarea rows="3" formControlName="description" placeholder="Short summary"></textarea>
    @if (form.get('description')!.invalid && form.get('description')!.touched) {
    <small class="error">Description is required (min 10 chars)</small>
    }
  </label>

  <fieldset>
    <legend>Ingredients</legend>
    <div class="ingredients" formArrayName="ingredients">
      @for (ctrl of ingredients.controls; let i = $index; track ctrl) {
      <div class="row">
        <input type="text" [formControlName]="i" placeholder="Ingredient" />
        <button type="button" class="btn" (click)="removeIngredient(i)">Remove</button>
      </div>
      }
    </div>

    <button class="btn btn-primary add-ingredient" type="button" (click)="addIngredient()">
      Add Ingredient
    </button>
  </fieldset>

  <label>
    <span>Instructions</span>
    <textarea rows="6" formControlName="instructions" placeholder="Step-by-step"></textarea>
    @if (form.get('instructions')!.invalid && form.get('instructions')!.touched) {
    <small class="error">Instructions are required (min 10 chars)</small>
    }
  </label>

  <label>
    <span>Thumbnail Image</span>
    <input type="file" accept="image/*" (change)="onFileSelected($event)" />
    @if (form.value.thumbnail) {
    <img class="preview" [src]="form.value.thumbnail" alt="Preview" /> }
  </label>

  <div class="actions">
    <button class="btn btn-primary" type="submit">
      @if (isEdit()) { Save Changes } @else { Create Recipe }
    </button>
    <a class="btn" (click)="confirmCancel($event)">Cancel</a>
  </div>
</form>
